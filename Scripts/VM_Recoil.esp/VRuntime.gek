scn VRuntime

float VMx
float VMy
float VMz

float VMxI
float VMyI
float VMzI

float DefA0
float DefA1
float DefA2

float MinCount

int Fin

array_var DefRot
array_var DefTrans
array_var DefRotIS

float timer

float vVerticalIntensity
float vHorizontalIntensity
float vStrengthCoeffV
float vStrengthCoeffH
float vWeightInfluenceV
float vWeightInfluenceH
float vIsRandomized
float vWeaponDamageCoeff

float xSpeed


begin gamemode

	if getgameloaded && getgamerestarted
		
		SetOnFireWeaponEventHandler Vweapon 1 player
		
		set vVerticalIntensity to GetINIFloat "General:vVerticalIntensity" "VM_Recoil.ini"
		set vHorizontalIntensity to GetINIFloat "General:vHorizontalIntensity" "VM_Recoil.ini"
		set vWeaponDamageCoeff to GetINIFloat "General:vWeaponDamageCoeff" "VM_Recoil.ini"
		set vStrengthCoeffV to GetINIFloat "Stats:vStrengthCoeffV" "VM_Recoil.ini"
		set vStrengthCoeffH to GetINIFloat "Stats:vStrengthCoeffH" "VM_Recoil.ini"
		set vWeightInfluenceV to GetINIFloat "Stats:vWeightInfluenceV" "VM_Recoil.ini"
		set vWeightInfluenceH to GetINIFloat "Stats:vWeightInfluenceH" "VM_Recoil.ini"
		set vIsRandomized to GetINIFloat "Randomization:vIsRandomized" "VM_Recoil.ini"
		
	endif
		
		
	
	;PrintToConsole "timer is: %g" timer
	
	if IsPC1stPerson == 1
		
		
		;xSpeed is left here for future attempts to make x movement less snappy
		; if DefA0 > 0.2
			
		; elseif DefA0 < -0.2
			
		; else
			; let xSpeed := DefA0
		; endif
		
		;PrintToConsole "xSpeed is: %g" xSpeed
		
		let DefTrans := player.GetNifBlockRotation "Spine0Controller"
		let VMxI := DefTrans[0]*MinCount + DefA0
		let VMyI := DefTrans[2]*MinCount + DefA1
		let VMzI := DefTrans[1]*MinCount + DefA2


		
		let DefTrans := player.GetNifBlockRotation "NeckController"
		let VMx := DefTrans[0]*MinCount + DefA0
		let VMy := DefTrans[2]*MinCount + DefA1
		let VMz := DefTrans[1]*MinCount - DefA2
		
		;let xSpeed += 0.1	
		;PrintToConsole "DefA2 is: %g" DefA2
		;PrintToConsole "DefA1 is: %g" DefA1
		
		;this multiplier should slowly zero all rotation - but only if we stop firing
		;useless? probably, but movement feels less snappy monkaHmm
		let MinCount := 0.9
		
		if VMx < 0.0001 && VMx > -0.0001 
				let VMx := 0
		endif
		if VMy < 0.0001 && VMy > -0.0001 
			let VMy := 0
		endif
		if VMz < 0.0001 && VMz > -0.0001 
			let VMz := 0
		endif
		
		player.SetNifBlockRotation "NeckController" VMx VMz VMy
		player.SetNifBlockRotation "Spine0Controller" VMxI VMzI VMyI
		

		let DefA0 := DefA0 * MinCount
		let DefA1 := DefA1 * MinCount
		let DefA2 := DefA2 * MinCount
		if DefA1 < 0.0001 && DefA1 > -0.0001 
			let DefA1 := 0
		endif
		if DefA0 < 0.0001 && DefA0 > -0.0001 
			let DefA0 := 0
		endif
		if DefA2 < 0.0001 && DefA2 > -0.0001 
			let DefA0 := 0
		endif
	endif

	
end